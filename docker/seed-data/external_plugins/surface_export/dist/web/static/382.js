"use strict";(self.webpackChunk_solarcloud7_plugin_surface_export=self.webpackChunk_solarcloud7_plugin_surface_export||[]).push([[382],{731(e,t,a){a.d(t,{A:()=>l});var r=a(601),n=a.n(r),s=a(314),i=a.n(s)()(n());i.push([e.id,`.surface-export-tab-body {
	display: grid;
	grid-template-columns: 1fr;
	gap: 16px;
}

@media (min-width: 1200px) {
	.surface-export-tab-body {
		grid-template-columns: 1.2fr 0.8fr;
		align-items: start;
	}
}

.surface-export-tree-panel,
.surface-export-action-panel {
	min-width: 0;
}

.surface-export-log-body {
	display: grid;
	grid-template-columns: 1fr;
	gap: 16px;
}

.surface-export-log-row {
	cursor: pointer;
}

.surface-export-log-row-selected > td {
	background: rgba(24, 144, 255, 0.12) !important;
}
`,""]);let l=i},314(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a="",r=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),r&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),r&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a}).join("")},t.i=function(e,a,r,n,s){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var l=0;l<this.length;l++){var o=this[l][0];null!=o&&(i[o]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&i[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),a&&(d[2]&&(d[1]="@media ".concat(d[2]," {").concat(d[1],"}")),d[2]=a),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},601(e){e.exports=function(e){return e[1]}},20(e,t,a){var r=a(27),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,a){var r,s={},c=null,d=null;for(r in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,r)&&!o.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:n,type:e,key:c,ref:d,props:s,_owner:l.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},848(e,t,a){e.exports=a(20)},72(e){var t=[];function a(e){for(var a=-1,r=0;r<t.length;r++)if(t[r].identifier===e){a=r;break}return a}function r(e,r){for(var n={},s=[],i=0;i<e.length;i++){var l=e[i],o=r.base?l[0]+r.base:l[0],c=n[o]||0,d="".concat(o," ").concat(c);n[o]=c+1;var u=a(d),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var p=function(e,t){var a=t.domAPI(t);return a.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&a.update(e=t):a.remove()}}(m,r);r.byIndex=i,t.splice(i,0,{identifier:d,updater:p,references:1})}s.push(d)}return s}e.exports=function(e,n){var s=r(e=e||[],n=n||{});return function(e){e=e||[];for(var i=0;i<s.length;i++){var l=a(s[i]);t[l].references--}for(var o=r(e,n),c=0;c<s.length;c++){var d=a(s[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=o}}},659(e){var t={};e.exports=function(e,a){var r=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(a)}},540(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56(e,t,a){e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},825(e){e.exports=function(e){if("u"<typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){var r,n,s;r="",a.supports&&(r+="@supports (".concat(a.supports,") {")),a.media&&(r+="@media ".concat(a.media," {")),(n=void 0!==a.layer)&&(r+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),r+=a.css,n&&(r+="}"),a.media&&(r+="}"),a.supports&&(r+="}"),(s=a.sourceMap)&&"u">typeof btoa&&(r+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)},remove:function(){var e;null===(e=t).parentNode||e.parentNode.removeChild(e)}}}},113(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},382(e,t,a){a.r(t),a.d(t,{WebPlugin:()=>WebPlugin});var r=a(848),n=a(860),s=a(968),i=a(68),l=a(696),o=a(72),c=a.n(o),d=a(825),u=a.n(d),m=a(659),p=a.n(m),f=a(56),h=a.n(f),y=a(540),g=a.n(y),x=a(113),v=a.n(x),I=a(731),S={};S.styleTagTransform=v(),S.setAttributes=h(),S.insert=p().bind(null,"head"),S.domAPI=u(),S.insertStyleElement=g(),c()(I.A,S),I.A&&I.A.locals&&I.A.locals;let{PERMISSIONS:b,GetPlatformTreeRequest:T,ListTransactionLogsRequest:N,GetTransactionLogRequest:j,StartPlatformTransferRequest:w,SetSurfaceExportSubscriptionRequest:k,SurfaceExportTreeUpdateEvent:C,SurfaceExportTransferUpdateEvent:E,SurfaceExportLogUpdateEvent:A}=l,{Text:M}=s.Typography;function L(e){switch(e){case"transporting":return"processing";case"awaiting_validation":return"gold";case"completed":return"success";case"failed":case"error":case"cleanup_failed":return"error";default:return"default"}}function $(e,t=null){return e?{transferId:e.transferId||e.id||null,platformName:e.platformName||"Unknown",sourceInstanceId:e.sourceInstanceId??-1,sourceInstanceName:e.sourceInstanceName??null,targetInstanceId:e.targetInstanceId??-1,targetInstanceName:e.targetInstanceName??null,status:e.status||"unknown",startedAt:e.startedAt||Date.now(),completedAt:e.completedAt||null,failedAt:e.failedAt||null,error:e.error||null,lastEventAt:t}:null}function P(e,t){let a=new Map((e||[]).map(e=>[e.transferId,e]));return t&&t.transferId&&a.set(t.transferId,{...a.get(t.transferId),...t}),Array.from(a.values()).sort((e,t)=>(t.startedAt||0)-(e.startedAt||0))}function _({plugin:e,state:t}){let[a,i]=(0,n.useState)(null),[l,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),{tree:u,loadingTree:m,treeError:p}=t,f=(0,n.useMemo)(()=>{let e=new Map;if(!u)return e;let t=t=>{for(let a of t.platforms||[]){let r=`platform:${t.instanceId}:${a.platformIndex}`;e.set(r,{instanceId:t.instanceId,instanceName:t.instanceName,forceName:a.forceName||u.forceName||"player",...a})}};for(let e of u.hosts||[])for(let a of e.instances||[])t(a);for(let e of u.unassignedInstances||[])t(e);return e},[u]),h=(0,n.useMemo)(()=>{if(!u)return[];let e=[];for(let t of u.hosts||[])for(let a of[...t.instances||[]].sort((e,t)=>e.instanceName.localeCompare(t.instanceName)))for(let r of a.platforms||[])e.push({key:`platform:${a.instanceId}:${r.platformIndex}`,hostName:t.hostName,hostConnected:t.connected,instanceId:a.instanceId,instanceName:a.instanceName,instanceConnected:a.connected,instancePlatformError:a.platformError,platform:r});if(u.unassignedInstances?.length)for(let t of[...u.unassignedInstances].sort((e,t)=>e.instanceName.localeCompare(t.instanceName)))for(let a of t.platforms||[])e.push({key:`platform:${t.instanceId}:${a.platformIndex}`,hostName:"Unassigned",hostConnected:null,instanceId:t.instanceId,instanceName:t.instanceName,instanceConnected:t.connected,instancePlatformError:t.platformError,platform:a});return e},[u]),y=a?f.get(a):null,g=(0,n.useMemo)(()=>{if(!u)return[];let e=[];for(let t of u.hosts||[])for(let a of t.instances||[])e.push(a);for(let t of u.unassignedInstances||[])e.push(t);return e.filter(e=>e.instanceId!==y?.instanceId).map(e=>({label:`${e.instanceName} (${e.instanceId})`,value:e.instanceId}))},[u,y]);async function x(){if(y&&null!==l){d(!0);try{let t=await e.startTransfer({sourceInstanceId:y.instanceId,sourcePlatformIndex:y.platformIndex,targetInstanceId:Number(l),forceName:y.forceName||"player"});if(!t.success){let e=`Error: ${t.error||"Unknown error"} | Source: Instance ${y.instanceId} (${y.instanceName}) | Platform: ${y.platformName} (index ${y.platformIndex}) | Target: Instance ${l}`;throw console.error("[Surface Export] Transfer failed:",e),Error(t.error||"Transfer start failed")}console.info(`[Surface Export] Transfer started: ${t.transferId}`),s.message.success(`Transfer started: ${t.transferId}`,5)}catch(e){console.error("[Surface Export] Transfer submission error:",e),s.message.error(e.message||"Failed to start transfer",10)}finally{d(!1)}}}let v=[{title:"Host",dataIndex:"hostName",key:"hostName",width:"15%",render:(e,t)=>(0,r.jsxs)(s.Space,{children:[(0,r.jsx)(M,{children:e}),null!==t.hostConnected?(0,r.jsx)(s.Tag,{color:t.hostConnected?"green":"default",children:t.hostConnected?"online":"offline"}):null]})},{title:"Instance",dataIndex:"instanceName",key:"instanceName",width:"25%",render:(e,t)=>(0,r.jsxs)(s.Space,{children:[(0,r.jsx)(M,{children:e}),(0,r.jsx)(s.Tag,{color:t.instanceConnected?"green":"default",children:t.instanceConnected?"connected":"disconnected"}),t.instancePlatformError?(0,r.jsx)(s.Tag,{color:"warning",children:"error"}):null]})},{title:"Platform",key:"platform",width:"40%",render:(e,t)=>(0,r.jsxs)(s.Space,{children:[(0,r.jsx)(M,{children:t.platform.platformName}),(0,r.jsx)(s.Tag,{color:L(t.platform.transferStatus),children:t.platform.transferStatus||"idle"})]})}];return(0,r.jsxs)("div",{className:"surface-export-tab-body",children:[(0,r.jsx)("div",{className:"surface-export-tree-panel",children:(0,r.jsxs)(s.Card,{title:"Available Platforms",children:[m?(0,r.jsx)(s.Spin,{}):null,p?(0,r.jsx)(s.Alert,{type:"error",showIcon:!0,message:p}):null,m||h.length?null:(0,r.jsx)(s.Empty,{description:"No platforms found"}),h.length?(0,r.jsx)(s.Table,{size:"small",columns:v,dataSource:h,rowKey:e=>e.key,pagination:{pageSize:15},rowClassName:e=>e.key===a?"surface-export-log-row-selected":"surface-export-log-row",onRow:e=>({onClick:()=>i(e.key)})}):null]})}),(0,r.jsx)("div",{className:"surface-export-action-panel",children:(0,r.jsx)(s.Card,{title:"Manual Transfer",children:(0,r.jsxs)(s.Space,{direction:"vertical",size:"middle",style:{width:"100%"},children:[y?(0,r.jsx)(s.Alert,{type:"info",showIcon:!0,message:`Source: ${y.platformName}`,description:`Instance ${y.instanceName} (${y.instanceId})`}):(0,r.jsx)(s.Alert,{type:"warning",showIcon:!0,message:"Select a source platform in the tree"}),(0,r.jsx)(s.Select,{placeholder:"Select destination instance",options:g,value:l,onChange:o,disabled:!y}),(0,r.jsx)(s.Button,{type:"primary",onClick:x,disabled:!y||null===l,loading:c,children:"Start Transfer"})]})})})]})}function F(e){return String(e||"").replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim().replace(/^./,e=>e.toUpperCase())}function D(e){return"number"!=typeof e||Number.isNaN(e)?"-":e>=1e3?`${(e/1e3).toFixed(1)}s (${Math.round(e).toLocaleString()}ms)`:`${Math.round(e).toLocaleString()}ms`}function R(e,t=1){return"number"!=typeof e||Number.isNaN(e)?"-":e.toLocaleString(void 0,{maximumFractionDigits:t})}function U(e,t=1){if("number"!=typeof e||Number.isNaN(e))return"-";let a=e>0?"+":"";return`${a}${e.toLocaleString(void 0,{maximumFractionDigits:t})}`}function z(e){return Object.values(e||{}).reduce((e,t)=>{let a=Number(t);return Number.isFinite(a)?e+a:e},0)}function O(e){return e&&"object"==typeof e?Object.entries(e).map(([e,t])=>{let a="-";if("boolean"==typeof t)a=t?"Yes":"No";else if("number"==typeof t){let r=e.toLowerCase();a=r.endsWith("ms")?`${R(t,0)} ms`:r.endsWith("ticks")?`${R(t,0)} ticks`:r.endsWith("kb")?`${R(t,1)} KB`:R(t,+!Number.isInteger(t))}else null!=t&&(a=String(t));return{key:e,metric:F(e),value:a}}):[]}function V(e,t){let a=e||{},r=t||{},n=new Set([...Object.keys(a),...Object.keys(r)]),s=[];for(let e of n){let t=Number(a[e]||0),n=Number(r[e]||0),i=n-t;s.push({key:e,name:e,expected:t,actual:n,delta:i,preservedPct:t>0?n/t*100:null})}return s.sort((e,t)=>Math.abs(t.delta)-Math.abs(e.delta)||e.name.localeCompare(t.name)),s}function H(e,t){for(let a=e.length-1;a>=0;a-=1)if(t(e[a]))return e[a];return null}function W({plugin:e,state:t}){let[a,i]=(0,n.useState)(null),l=a?t.logDetails[a]:null,o=(0,n.useMemo)(()=>{let e,t,r,n,s,i,o,c,d,u,m,p,f,h,y,g,x;return l?(e=l?.transferInfo||null,t=Array.isArray(l?.events)?l.events:[],r=l?.summary&&"object"==typeof l.summary?l.summary:{},n=H(t,e=>e?.eventType==="transfer_created"),s=H(t,e=>e?.eventType==="validation_received"||e?.eventType==="validation_failed"||e?.validation),i=H(t,e=>e?.eventType==="transfer_completed"||e?.eventType==="transfer_failed"),o=t.length?t[t.length-1]:null,c=e?.status||r.status||"unknown",(d=r.result)||(d="completed"===c?"SUCCESS":["failed","error","cleanup_failed"].includes(c)?"FAILED":"IN_PROGRESS"),u=e?.startedAt||r.startedAt||n?.timestampMs||null,m=e?.completedAt||r.completedAt||null,p=e?.failedAt||r.failedAt||null,f=r.lastEventAt||o?.timestampMs||null,h=m||p||i?.timestampMs||f,null===(y="number"==typeof r.totalDurationMs?r.totalDurationMs:null)&&u&&h&&(y=Math.max(0,h-u)),null===y&&"number"==typeof i?.durationMs&&(y=i.durationMs),g=r.validation||s?.validation||null,(x=r.sourceVerification||n?.sourceVerification||null)||!g||(x={itemCounts:g.expectedItemCounts||{},fluidCounts:g.expectedFluidCounts||{}}),{transferId:a,result:d,status:c,totalDurationMs:y,totalDurationStr:r.totalDurationStr||D(y),phases:r.phases||i?.phases||{},platform:r.platform||{name:e?.platformName||"Unknown",source:{instanceId:e?.sourceInstanceId??-1,instanceName:e?.sourceInstanceName??null},destination:{instanceId:e?.targetInstanceId??-1,instanceName:e?.targetInstanceName??null}},payload:r.payload||i?.payloadMetrics||n?.payloadMetrics||null,import:r.import||i?.importMetrics||s?.importMetrics||null,validation:g,sourceVerification:x,startedAt:u,completedAt:m,failedAt:p,lastEventAt:f,error:r.error||e?.error||null}):null},[l,a]),c=[{title:"Transfer",dataIndex:"transferId",key:"transferId",render:e=>(0,r.jsx)(M,{code:!0,children:e})},{title:"Platform",dataIndex:"platformName",key:"platformName"},{title:"Source",key:"source",render:(e,t)=>t.sourceInstanceName||t.sourceInstanceId},{title:"Destination",key:"destination",render:(e,t)=>t.targetInstanceName||t.targetInstanceId},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,r.jsx)(s.Tag,{color:L(e),children:e})},{title:"Started",dataIndex:"startedAt",key:"startedAt",render:e=>e?new Date(e).toLocaleString():"-"}],d=[{title:"Metric",dataIndex:"metric",key:"metric",width:"60%"},{title:"Value",dataIndex:"value",key:"value"}],u=[{title:"Key",dataIndex:"name",key:"name",width:"40%",render:e=>(0,r.jsx)(M,{code:!0,children:e})},{title:"Expected",dataIndex:"expected",key:"expected",render:e=>R(e,+!Number.isInteger(e))},{title:"Actual",dataIndex:"actual",key:"actual",render:e=>R(e,+!Number.isInteger(e))},{title:"Δ",dataIndex:"delta",key:"delta",render:e=>(0,r.jsx)(M,{type:0===e?void 0:e>0?"success":"danger",children:U(e,+!Number.isInteger(e))})},{title:"Preserved",dataIndex:"preservedPct",key:"preservedPct",render:e=>null===e?"-":`${R(e,1)}%`}],m=(l?.events||[]).map(e=>{let t=e.eventType||"",a=t.includes("failed")||t.includes("error"),n=t.includes("completed")||t.includes("success");return{color:a?"red":n?"green":"blue",label:e.timestamp?new Date(e.timestamp).toLocaleTimeString():"",children:(0,r.jsxs)("div",{children:[(0,r.jsx)(M,{strong:!0,children:e.eventType||"event"}),(0,r.jsx)("div",{children:e.message||""})]})}}),p=(0,n.useMemo)(()=>Object.entries(o?.phases||{}).map(([e,t])=>({key:e,phase:F(String(e).replace(/Ms$/,"")),durationMs:Number(t)||0,duration:D(Number(t)||0)})).sort((e,t)=>t.durationMs-e.durationMs),[o]),f=(0,n.useMemo)(()=>O(o?.payload),[o]),h=(0,n.useMemo)(()=>O(o?.import),[o]),y=o?.validation||null,g=(0,n.useMemo)(()=>y?[{key:"itemCountMatch",metric:"Item counts match",value:y.itemCountMatch?"Yes":"No"},{key:"fluidCountMatch",metric:"Fluid counts match",value:y.fluidCountMatch?"Yes":"No"},{key:"entityCount",metric:"Entity count",value:R(y.entityCount,0)},{key:"itemTypesExpected",metric:"Item types (expected)",value:R(y.itemTypesExpected,0)},{key:"itemTypesActual",metric:"Item types (actual)",value:R(y.itemTypesActual,0)},{key:"fluidTypesExpected",metric:"Fluid types (expected)",value:R(y.fluidTypesExpected,0)},{key:"fluidTypesActual",metric:"Fluid types (actual)",value:R(y.fluidTypesActual,0)}]:[],[y]),x=y?.expectedItemCounts||o?.sourceVerification?.itemCounts||{},v=y?.actualItemCounts||{},I=y?.expectedFluidCounts||o?.sourceVerification?.fluidCounts||{},S=y?.actualFluidCounts||{},b=(0,n.useMemo)(()=>V(x,v),[x,v]),T=(0,n.useMemo)(()=>V(I,S),[I,S]),N=(0,n.useMemo)(()=>{if(!y)return[];let e=y.totalExpectedItems??z(x),t=y.totalActualItems??z(v),a=y.totalExpectedFluids??z(I),r=y.totalActualFluids??z(S);return[{key:"items",name:"Items (total)",expected:e,actual:t,delta:t-e,preservedPct:e>0?t/e*100:null},{key:"fluids",name:"Fluids (total)",expected:a,actual:r,delta:r-a,preservedPct:a>0?r/a*100:null}]},[y,x,v,I,S]),j=(0,n.useMemo)(()=>Object.entries(y?.entityTypeBreakdown||{}).map(([e,t])=>({key:e,entityType:e,count:Number(t)||0})).sort((e,t)=>t.count-e.count),[y]),w=(0,n.useMemo)(()=>{let e=y?.fluidReconciliation;return e?[{key:"rawFluidDelta",metric:"Raw fluid delta",value:U(e.rawFluidDelta,1)},{key:"reconciledFluidLoss",metric:"Reconciled fluid loss",value:R(e.reconciledFluidLoss,1)},{key:"lowTempLoss",metric:"Low-temp loss",value:R(e.lowTempLoss,1)},{key:"highTempReconciledLoss",metric:"High-temp reconciled loss",value:R(e.highTempReconciledLoss,1)},{key:"fluidPreservedPct",metric:"Fluid preserved",value:`${R(e.fluidPreservedPct,1)}%`},{key:"highTempThreshold",metric:"High-temp threshold",value:R(e.highTempThreshold,0)}]:[]},[y]),k=(0,n.useMemo)(()=>Object.entries(y?.fluidReconciliation?.highTempAggregates||{}).map(([e,t])=>({key:e,name:e,expected:Number(t?.expected||0),actual:Number(t?.actual||0),delta:Number(t?.delta||0),reconciled:!!t?.reconciled})).sort((e,t)=>Math.abs(t.delta)-Math.abs(e.delta)||e.name.localeCompare(t.name)),[y]),C=o?.status||l?.transferInfo?.status||"unknown",E=o?.result||"IN_PROGRESS",A=!!(l&&o),$=!!y;return(0,r.jsxs)("div",{className:"surface-export-log-body",children:[(0,r.jsx)(s.Card,{title:"Recent Transfer Logs",children:(0,r.jsx)(s.Table,{size:"small",columns:c,dataSource:t.transferSummaries,rowKey:e=>e.transferId,pagination:{pageSize:10},rowClassName:e=>e.transferId===a?"surface-export-log-row-selected":"surface-export-log-row",onRow:t=>({onClick:async()=>{i(t.transferId);try{await e.loadTransactionLog(t.transferId)}catch(e){s.message.error(e.message||"Failed to load transaction log")}}})})}),a?null:(0,r.jsx)(s.Card,{title:"Transfer Details",children:(0,r.jsx)(s.Empty,{description:"Select a transfer row to view details"})}),a&&!l?(0,r.jsx)(s.Card,{title:"Transfer Details",children:(0,r.jsx)(s.Spin,{})}):null,A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Card,{title:"Transfer Summary",children:[(0,r.jsx)(s.Alert,{type:"SUCCESS"===E?"success":"FAILED"===E?"error":"info",showIcon:!0,message:`${E}: ${o.platform?.name||a}`,description:`Duration: ${o.totalDurationStr} | Status: ${C}`}),(0,r.jsxs)(s.Space,{direction:"vertical",style:{width:"100%",marginTop:12},children:[o.error?(0,r.jsx)(s.Alert,{type:"error",showIcon:!0,message:"Transfer error",description:o.error}):null,(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:d,dataSource:[{key:"platform",metric:"Platform",value:o.platform?.name||"-"},{key:"source",metric:"Source",value:o.platform?.source?.instanceName||o.platform?.source?.instanceId||"-"},{key:"destination",metric:"Destination",value:o.platform?.destination?.instanceName||o.platform?.destination?.instanceId||"-"}]})]})]}),(0,r.jsx)(s.Card,{title:"Phase Timing",children:p.length?(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:[{title:"Phase",dataIndex:"phase",key:"phase"},{title:"Duration",dataIndex:"duration",key:"duration"}],dataSource:p}):(0,r.jsx)(s.Empty,{description:"No phase timing data available yet"})}),(0,r.jsx)(s.Card,{title:"Payload Metrics",children:f.length?(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:d,dataSource:f}):(0,r.jsx)(s.Empty,{description:"No payload metrics available"})}),(0,r.jsx)(s.Card,{title:"Import Processing Metrics",children:h.length?(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:d,dataSource:h}):(0,r.jsx)(s.Empty,{description:"No import metrics available"})}),(0,r.jsx)(s.Card,{title:"Validation Overview",children:$?(0,r.jsxs)(s.Space,{direction:"vertical",style:{width:"100%"},children:[(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:d,dataSource:g}),y?.mismatchDetails?(0,r.jsx)(s.Alert,{type:"error",showIcon:!0,message:"Validation mismatch details",description:y.mismatchDetails}):null,(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:u,dataSource:N})]}):(0,r.jsx)(s.Empty,{description:"No validation data available yet"})}),(0,r.jsx)(s.Card,{title:"Entity Type Breakdown",children:j.length?(0,r.jsx)(s.Table,{size:"small",pagination:{pageSize:10},columns:[{title:"Entity Type",dataIndex:"entityType",key:"entityType",render:e=>(0,r.jsx)(M,{code:!0,children:e})},{title:"Count",dataIndex:"count",key:"count",render:e=>R(e,0)}],dataSource:j}):(0,r.jsx)(s.Empty,{description:"No entity breakdown available"})}),(0,r.jsx)(s.Card,{title:"Item Inventory (Expected vs Actual)",children:b.length?(0,r.jsx)(s.Table,{size:"small",pagination:{pageSize:20},columns:u,dataSource:b}):(0,r.jsx)(s.Empty,{description:"No item inventory data available"})}),(0,r.jsx)(s.Card,{title:"Fluid Inventory (Expected vs Actual)",children:T.length?(0,r.jsx)(s.Table,{size:"small",pagination:{pageSize:20},columns:u,dataSource:T}):(0,r.jsx)(s.Empty,{description:"No fluid inventory data available"})}),(0,r.jsx)(s.Card,{title:"High-Temperature Fluid Aggregates",children:k.length?(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:[{title:"Fluid",dataIndex:"name",key:"name",render:e=>(0,r.jsx)(M,{code:!0,children:e})},{title:"Expected",dataIndex:"expected",key:"expected",render:e=>R(e,1)},{title:"Actual",dataIndex:"actual",key:"actual",render:e=>R(e,1)},{title:"Δ",dataIndex:"delta",key:"delta",render:e=>U(e,1)},{title:"Reconciled",dataIndex:"reconciled",key:"reconciled",render:e=>e?"Yes":"No"}],dataSource:k}):(0,r.jsx)(s.Empty,{description:"No high-temp aggregate data available"})}),w.length?(0,r.jsx)(s.Card,{title:"Fluid Reconciliation",children:(0,r.jsx)(s.Table,{size:"small",pagination:!1,columns:d,dataSource:w})}):null,(0,r.jsx)(s.Card,{title:"Transfer Timeline",children:(0,r.jsx)(s.Timeline,{items:m})})]}):null]})}function B(){let e=(0,n.useContext)(i.ControlContext).plugins.get("surface_export"),t=function(e){let[t,a]=(0,n.useState)(e.getState());return(0,n.useEffect)(()=>{function t(){a(e.getState())}return e.onUpdate(t),()=>e.offUpdate(t)},[e]),t}(e),a=[{key:"manual",label:"Manual Transfer",children:(0,r.jsx)(_,{plugin:e,state:t})}];return!1!==t.canViewLogs&&a.push({key:"logs",label:"Transaction Logs",children:(0,r.jsx)(W,{plugin:e,state:t})}),(0,r.jsxs)(i.PageLayout,{nav:[{name:"Surface Export"}],children:[(0,r.jsx)(i.PageHeader,{title:"Surface Export"}),(0,r.jsx)(s.Tabs,{defaultActiveKey:"manual",items:a})]})}let WebPlugin=class WebPlugin extends i.BaseWebPlugin{constructor(e,t,a,r,n){super(e,t,a,r,n),this.callbacks=[],this.liveUpdatesEnabled=!1,this.state={tree:null,loadingTree:!1,treeError:null,transferSummaries:[],logDetails:{},lastTreeRevision:0,lastTransferRevision:0,lastLogRevision:0,canViewLogs:!0}}async init(){this.pages=[{path:"/surface-export",sidebarName:"Surface Export",permission:b.UI_VIEW,content:(0,r.jsx)(B,{})}],this.control.handle(C,this.handleTreeUpdate.bind(this)),this.control.handle(E,this.handleTransferUpdate.bind(this)),this.control.handle(A,this.handleLogUpdate.bind(this))}onControllerConnectionEvent(e){("connect"===e||"resume"===e)&&this.syncLiveState().catch((0,i.notifyErrorHandler)("Failed to resubscribe Surface Export live updates"))}getState(){return this.state}setState(e){for(let t of(this.state={...this.state,...e},this.callbacks))t()}onUpdate(e){this.callbacks.push(e),this.syncLiveState().catch((0,i.notifyErrorHandler)("Failed to start Surface Export live updates"))}offUpdate(e){let t=this.callbacks.lastIndexOf(e);-1!==t&&this.callbacks.splice(t,1),this.syncLiveState().catch((0,i.notifyErrorHandler)("Failed to update Surface Export subscription"))}async syncLiveState(){let e=this.callbacks.length>0;if(!this.control.connector.connected){this.liveUpdatesEnabled=e;return}let t=t=>this.control.send(new k({tree:e,transfers:e,logs:t,transferId:null})),a=e&&!1!==this.state.canViewLogs;try{await t(a)}catch(e){if(a&&/permission denied/i.test(e?.message||""))a=!1,this.setState({canViewLogs:!1}),await t(!1);else throw e}this.liveUpdatesEnabled=e,e&&await this.refreshSnapshots()}async refreshSnapshots(){this.setState({loadingTree:!0,treeError:null});try{let e=await this.control.send(new T({forceName:"player"})),t=this.state.transferSummaries;if(!1!==this.state.canViewLogs)try{let e=await this.control.send(new N({limit:100}));t=Array.isArray(e)?[...e].sort((e,t)=>(t.startedAt||0)-(e.startedAt||0)):[]}catch(e){if(/permission denied/i.test(e?.message||""))this.setState({canViewLogs:!1}),t=[];else throw e}this.setState({tree:{forceName:e.forceName,hosts:e.hosts||[],unassignedInstances:e.unassignedInstances||[],revision:e.revision,generatedAt:e.generatedAt},transferSummaries:t,loadingTree:!1,treeError:null})}catch(e){this.setState({loadingTree:!1,treeError:e.message||"Failed to refresh Surface Export state"})}}async startTransfer(e){return this.control.send(new w(e))}async loadTransactionLog(e){let t=await this.control.send(new j({transferId:e}));if(!t.success)throw Error(t.error||"Failed to load transaction log");let a=this.state.logDetails[e]||{},r=t.transferInfo||a.transferInfo||null,n=Array.isArray(t.events)?t.events:a.events||[],s={transferInfo:r,summary:t.summary||a.summary||null,events:n},i=$(r,n.length?n[n.length-1].timestampMs:null);i&&(i.transferId=e),this.setState({logDetails:{...this.state.logDetails,[e]:s},transferSummaries:i?P(this.state.transferSummaries,i):this.state.transferSummaries})}async handleTreeUpdate(e){e.revision<=this.state.lastTreeRevision||this.setState({tree:{forceName:e.forceName,hosts:e.tree?.hosts||[],unassignedInstances:e.tree?.unassignedInstances||[],revision:e.revision,generatedAt:e.generatedAt},loadingTree:!1,treeError:null,lastTreeRevision:e.revision})}async handleTransferUpdate(e){e.revision<=this.state.lastTransferRevision||this.setState({transferSummaries:P(this.state.transferSummaries,e.transfer),lastTransferRevision:e.revision})}async handleLogUpdate(e){if(e.revision<=this.state.lastLogRevision)return;let t=this.state.logDetails[e.transferId]||{events:[]},a=[...t.events],r=e.event||{},n=a.length?a[a.length-1]:null;n&&n.timestampMs===r.timestampMs&&n.eventType===r.eventType&&n.message===r.message||a.push(r);let s={transferInfo:e.transferInfo||t.transferInfo||null,summary:e.summary||t.summary||null,events:a},i=null;e.transferInfo&&((i=$(e.transferInfo,r.timestampMs||null)).transferId=e.transferId),this.setState({logDetails:{...this.state.logDetails,[e.transferId]:s},transferSummaries:i?P(this.state.transferSummaries,i):this.state.transferSummaries,lastLogRevision:e.revision})}}}}]);
//# sourceMappingURL=382.js.map